<html>
<head>
<meta charset="utf-8">
<title>Smart Reward</title>
<script src="vendor/waves-api.min.js"></script>
<script src="vendor/GitHub.bundle.min.js"></script>
<script>

    <!--++++++++++++++++++++++++++++++++++++ UI +++++++++++++++++++++++++++++++++++++++-->

    let developerNumber = 0;
    let developers = [];
    function addDeveloper(){
           if(developerNumber > 9) return;
           let container = document.getElementById('container');
           let row = document.createElement('div');

           let devName = document.createElement('input');
           devName.setAttribute('size',20);
           devName.setAttribute('type','text');
           devName.setAttribute('placeholder','Developer name');
           devName.setAttribute('id','devName' + developerNumber);
           row.appendChild(devName);

           let devWallet = document.createElement('input');
           devWallet.setAttribute('size',40);
           devWallet.setAttribute('type','text');
           devWallet.setAttribute('placeholder','Developer wallet');
           devWallet.setAttribute('id','devWallet' + developerNumber);
           row.appendChild(devWallet);

           let buttonAdd = document.createElement('button');
           buttonAdd.setAttribute('onclick','addDeveloper()');
           buttonAdd.innerText = 'add';
           row.appendChild(buttonAdd);

           if(developers[developerNumber]) {
               devName.value = developers[developerNumber].name;
               devWallet.value = developers[developerNumber].recipient;
           }

           container.insertBefore(row, container.children[0]);

           developerNumber++;
    }

    function info(message) {
        let newElement = document.createElement('div');
        newElement.style.color = 'green';
        newElement.textContent = 'SUCCESS. ' + message;

        let logger = document.getElementById('logger');
        logger.insertBefore(newElement, logger.children[0]);
    }

    function warn(message) {
        let newElement = document.createElement('div');
        newElement.style.color = 'red';
        newElement.textContent = 'ERROR. ' + message;

        let logger = document.getElementById('logger');
        logger.insertBefore(newElement, logger.children[0]);
    }

     <!--=============================== UI ===================================-->

    <!--++++++++++++++++++++++++++++++++++++ GITHUB +++++++++++++++++++++++++++++++++++++++-->

    const GITHUB = new GitHub();

    function checkRepository(){
        let profileName = document.getElementById('profileId').value;
        let repositoryName = document.getElementById('repositoryId').value;
        GITHUB.getRepo(profileName,repositoryName).getDetails().then((details) => {
                showWallet();
                info('Repository ' + details.data.html_url + ' exists');
            }).catch(e => {
                warn(JSON.stringify(e));
            });
    }

    function calculateSalary() {
        let profileName = document.getElementById('profileId').value;
        let repositoryName = document.getElementById('repositoryId').value;
        GITHUB.getRepo(profileName,repositoryName).listCommits().then((commits) => {
                let total = commits.data.length;
                for(data of commits.data) {
                    for(author of developers) {
                        if(author.name === data.commit.committer.name) {
                            author.commits++;
                        }
                    }
                }

                let moneyTotal = balance;
                for(author of developers) {
                    if(author.commits > 0) {
                        moneyTotal-=0.005;
                    }
                }
                moneyTotal *= 0.1;

                for(author of developers) {
                    let part = (author.commits / total);
                    author.amount = (moneyTotal * part).toFixed(3);
                    info(author.name + ' made ' + author.commits + ' commits (' + (part * 100).toFixed(0)
                        + '%). Salary is ' + author.amount);
                }

                let button = document.createElement('button');
                button.setAttribute('onclick','smartContract()');
                button.innerText = 'Create smart contract for protection';
                document.getElementById('container').appendChild(button);

            }).catch(e => {
                warn(JSON.stringify(e));
            });
    }

    <!--=============================== GITHUB ===================================-->

    <!--++++++++++++++++++++++++++++++++++++ WAVES +++++++++++++++++++++++++++++++++++++++-->

    const DECIMALS = 100000000;
    const WAVES = WavesAPI.create(WavesAPI.TESTNET_CONFIG);

    let balanceCheckTimer;
    let currentWallet;
    let balance;

    function showWallet(key){
        if(!currentWallet) {
            currentWallet = WAVES.Seed.create();
        }
        balanceCheckTimer = setInterval(checkBalance, 1000);
    }

    function checkBalance(){
        WAVES.API.Node.addresses.balanceDetails(currentWallet.address).then(balanceDetails => {
            balance = balanceDetails.available / DECIMALS;
            if(balance > 0.01) {
                clearInterval(balanceCheckTimer);

                addDeveloper();
                addDeveloper();

                let button = document.createElement('button');
                button.setAttribute('onclick','calculateSalary()');
                button.innerText = 'Calculate Salaries';
                document.getElementById('container').appendChild(button);
            }
            document.getElementById('userWalletId').textContent = 'Wallet address - ' + currentWallet.address;
            document.getElementById('userBalanceId').textContent =  'Balance - ' + balance + ' Waves';
            document.getElementById('userSeedId').textContent = 'Seed - ' + currentWallet.phrase;
        }).catch(e => {
            clearInterval(balanceCheckTimer);
            warn(e.message);
        });
    }

    async function smartContract() {
        let smartContract = `let signature = base58'${currentWallet.keyPair.publicKey}';`
        for(let index in developers) {
            smartContract += `let developer` + index + ` = base58'` + developers[index].recipient + `';`;
        }

        smartContract += `match tx { case tx:TransferTransaction => { let recipient = addressFromRecipient(tx.recipient).bytes; if((`;

        for(let index in developers) {
            if(index > 0) {
                smartContract += ` || `;
            }
            smartContract += `developer` + index + ` == recipient`;
        }

        smartContract += `) && sigVerify(tx.bodyBytes, tx.proofs[0], signature)) then true else false } case _ => true }`;

        WAVES.API.Node.utils.script.compile(smartContract).then(compiledContract => {
            publishContract(compiledContract)
            info('Contract compiled.');
        }).catch(e => warn(e.error));
    }

    function publishContract(compiledContract) {
        const contractTransaction = {
            fee: DECIMALS * 0.005,
            script: compiledContract,
            sender: currentWallet.address,
            senderPublicKey: currentWallet.keyPair.publicKey
        };

        WAVES.API.Node.transactions
            .broadcast(WAVES.constants.SET_SCRIPT_TX_NAME, contractTransaction, currentWallet.keyPair)
            .then(publishedContract => {
                info('Contract published.');

                let button = document.createElement('button');
                button.setAttribute('onclick','paySalaries()');
                button.innerText = 'Pay Salaries';
                document.getElementById('container').appendChild(button);

            }).catch(e => warn(e.error));
    }

    async function paySalaries(){
        for(let developer of developers) {
            transfer(developer.amount, developer.recipient, currentWallet.keyPair);
        }
    }

    async function transfer(amount, recipient, keyPair){
        const transferTransaction = {
            assetId: 'WAVES',
            feeAssetId: 'WAVES',
            fee: DECIMALS * 0.005,
            attachment: '',
            amount: amount * DECIMALS,
            recipient: recipient,
            timestamp: Date.now()
        };

        const transferred = await WAVES.API.Node.transactions
            .broadcast(WAVES.constants.TRANSFER_TX_NAME, transferTransaction, keyPair);
        info(`Waves ${amount} transferred to ${recipient}.`);
    }

    <!--========================== WAVES ===============================-->

    <!--++++++++++++++++++++++++TEST+++++++++++++++++++++++++++++-->

    async function testInit(){

        currentWallet = WAVES.Seed.fromExistingPhrase('income desk floor glide act forward pilot poet evoke squirrel circle april pupil razor pole');

        developers = [{recipient:'3NA1cH18k2tpbLewPJWNTVuR3LVjCyerSgB', amount: 0.02, name : 'Lipnevich', commits: 0},
                          {recipient:'3NAARTeT8RhcoG1Gr59V2AAPFqhbDULrpjB', amount: 0.02, name : 'VladislawKravchenok', commits : 0 },
                     ];

        document.getElementById('profileId').value = 'Lipnevich';
        document.getElementById('repositoryId').value = 'smart-rewarding';
    }

    async function testSmart(){
        smartContract();
    }

    async function testTransfer(){
        transferToAllDevelopers();
    }

    <!--============================TEST==============================-->

    </script>

</head>
<body onload="testInit()">


<!--<button onclick="testTransfer()">test transfer</button>-->
<!--<button onclick="testSmart()">test smart contract</button>-->

<div align="center">

    <div id="initRepoId">
        https://github.com/
        <input type="text" size="20" id="profileId" placeholder="Profile name"/>
        /
        <input type="text" size="20" id="repositoryId" placeholder="Repository name"/>


        <button onclick="checkRepository()" id="createButtonId">Create wallet</button>
    </div>


    <div id="userWalletId"></div>
    <div id="userBalanceId"></div>
    <div id="userSeedId"></div>

    <div id="container"></div>
    <div id="logger"></div>

</div>
</body>
</html>